language: node_js
dist: trusty
sudo: false
node_js: 8

services:
  - docker

addons:
  apt:
     sources:
        - google-chrome
     packages:
        - dbus
        - dbus-x11
        - xvfb
        - google-chrome-stable
        - libnotify-cil-dev

env:
  global:
    - DISPLAY=":99.0"
    - KEY_FROM_LAYER=true
    - DO_NOT_SET_WSKPROPS=true
    - REDIS_URL=redis://172.17.0.1:6379   # we'll pick up openwhisk's redis
    - WINDOW_WIDTH=1400
    - WINDOW_HEIGHT=1050
    - NO_DEBUGGER_BREAKPOINTS=true
    - NO_NOTIFICATIONS=true
    - NO_FIRST_TIMER=true
    - UV_THREADPOOL_SIZE=64

install:
    - echo "API_HOST=foo" > ~/.wskprops
    - echo "AUTH=bar" >>  ~/.wskprops
#    - npm install -g codecov istanbul &
    - (cd dist && npm install; cd ../app && npm install) &
    - (cd tests && npm install) &
    - (./tools/travis/setup.sh; ./tools/travis/build.sh; ./tools/travis/init_auth.sh) &
    - wait
    - cat ~/.wskprops
    - Xvfb :99 -screen 0 1400x1050x24 > /dev/null 2>&1 &

script: (cd tests && ./bin/runLocal.sh)

